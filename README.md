# Quotes Rails v7

* Ruby version 3.1.2
* Rails version 7.0.2.4

* Configuration
	* Install and configure you PostgreSQL database 
	* Configure your database credentials in the databsae.yml file

* Database creation
  * Development database -> quote_editor_development
  * Testing database     -> quote_editor_test

* Database initialization
  * Run `bin/setup`
    * If the migrations are not yet created, run `rails db:migrate`
  * Run `rails db:seed`
  * Run `bin/dev`

* How to run the test suite
  * Run `rails test:system`

# Rails 7 Notes

## Turbo Drive

### How does Turbo Drive work?

Turbo Drive works by intercepting "click" events on links and "submit" events on forms.

> Every time a link is clicked, Turbo Drive intercepts the "click" event, overrides the default behavior by transforming the HTML request the link click would normally trigger into an AJAX request. When Turbo Drive receives the response, it replaces the <body> of the current page with the <body> of the response, leaving the <head> unchanged in most cases.

For clicks on links, a pseudo-code implementation would look like this:

```javascript
// Select all links on the page
const links = document.querySelectorAll("a");

// Add a "click" event listener on each link to intercept the click
// and override the default behavior
links.forEach((link) => {
  link.addEventListener("click", (event) => {
    // Override default behavior
    event.preventDefault()
    // Convert the click on the link into an AJAX request
    // Replace the current page's <body> with the <body> of the response
    // and leave the <head> unchanged
  }
)});
```

> The same logic applies to form submissions. When a form is submitted, Turbo Drive intercepts the "submit" event and overrides the default behavior by transforming the form submission into an AJAX request and replacing the <body> of the current page with the <body> of the response, leaving the <head> unchanged.

For form submissions, a pseudo-code implementation would look like this:

```javascript
// Select all forms on the page
const forms = document.querySelectorAll("form");

// Add a "submit" event listener on each form to intercept the submission
// and override the default behavior
forms.forEach((form) => {
  form.addEventListener("submit", (event) => {
  // Override default behavior
    event.preventDefault()
    // Convert the form submission into an AJAX request
    // Replace the current page's <body> with the <body> of the response
    // and leave the <head> unchanged
  }
)});
```

### Disabling Turbo Drive

We may want to disable Turbo Drive for certain link clicks or form submissions in some cases. For example, this can be the case when working with gems that don't support Turbo Drive yet.

At the time writing this chapter, the Devise gem does not support Turbo Drive. A good workaround is to disable Turbo Drive on Devise forms such as the sign-in and sign-up forms.

**To disable Turbo Drive on a link or a form, we need to add the data-turbo="false" data attribute on it.**

For more information check the resource: [Turbo Drive](https://www.hotrails.dev/turbo-rails/turbo-drive)

## Turbo Frames and Turbo Stream templates

Objective: We would like to avoid this _context switch_. Instead, we would like to perform those two actions directly on the Quotes#index page.
### What are Turbo Frames?

Turbo Frames are independent pieces of a web page that can be appended, prepended, replaced, or removed without a complete page refresh and writing a single line of JavaScript!

To create Turbo Frames, we use the *turbo_frame_tag* helper. The *turbo_frame_tag* helper creates a **<turbo-frame>** custom element that contains the HTML generated by the content of the block.

This *<turbo-frame>* HTML tag does not exist in the HTML language. It is a custom element that was created in the **Turbo Javascript library**.

#### Turbo Frames rules

##### Rule 1 

> When clicking on a link within a Turbo Frame, if there is a frame with the same id on the target page, Turbo will replace the content of the Turbo Frame of the source page with the content of the Turbo Frame of the target page.

##### Rule 2

> When clicking on a link within a Turbo Frame, if there is no Turbo Frame with the same id on the target page, Turbo will remove the content of the Turbo Frame from the source page and log an error.

To check the Turbo Frames rules with examples, check the resource: [Turbo Frames cheat sheet](https://www.hotrails.dev/turbo-rails/turbo-frames-and-turbo-streams#:~:text=Turbo%20Frames%20cheat%20sheet)

##### Rule 3

> A link can target another frame than the one it is directly nested in thanks to the data-turbo-frame data attribute.

### Turbo Stream

The **turbo_stream** helper responds to the following methods

```ruby
# Remove a Turbo Frame
turbo_stream.remove

# Insert a Turbo Frame at the beginning/end of a list
turbo_stream.append
turbo_stream.prepend

# Insert a Turbo Frame before/after another Turbo Frame
turbo_stream.before
turbo_stream.after

# Replace or update the content of a Turbo Frame
turbo_stream.update
turbo_stream.replace
```



For more information check the resource: [Turbo Frames](https://www.hotrails.dev/turbo-rails/turbo-frames-and-turbo-streams)

